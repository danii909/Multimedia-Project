# Configurazione Video Stabilization System - ORB + RANSAC

# Parametri Motion Estimation (non usati con optical_flow, ma necessari per compatibilità)
motion_estimation:
  block_size: 16
  search_range: 16
  metric: "sad"

# Parametri Global Motion Estimation
global_motion:
  motion_model: "translation" # Modello di movimento: 'translation', 'affine', 'homography'
  outlier_threshold: 2.0      # Soglia per rimozione outlier (deviazioni standard)
  aggregation_method: "median" # Metodo aggregazione: 'median', 'mean', 'weighted_mean'
  estimate_rotation: true     # Abilita stima e compensazione rotazioni (roll/pan/tilt)
  estimation_method: "optical_flow" # Usa optical_flow con feature_type='orb'
  optical_flow:
    feature_type: "orb"         # ORB features (invece di Shi-Tomasi + LK)
    transform_type: "partial"   # Transform RANSAC: 'partial' (4 param), 'affine' (6 param), 'homography' (8 param)
    
    # Parametri ORB
    orb_n_features: 500         # Numero massimo di features ORB da rilevare
    orb_scale_factor: 1.2       # Fattore di scala piramidale (> 1.0)
    orb_n_levels: 8             # Numero di livelli della piramide
    orb_edge_threshold: 31      # Soglia per escludere edge (default 31)
    orb_ratio_threshold: 0.75   # Lowe's ratio test threshold (0-1, più basso = più stringente)
    
    # RANSAC
    ransac_reproj_threshold: 3.0 # Soglia RANSAC per filtrare outlier (pixel)

# Parametri Trajectory Smoothing
trajectory_smoothing:
  smoothing_window: 30        # Finestra temporale per smoothing (frame)
  filter_type: "moving_average" # Tipo filtro: 'moving_average', 'gaussian', 'exponential'
  gaussian_sigma: 2.0         # Sigma per filtro gaussiano (se usato)
  exponential_alpha: 0.9      # Alpha per filtro esponenziale (se usato)
  deadband_px: 0.0            # Soglia (px) sotto la quale l'offset viene azzerato

# Parametri Motion Compensation
motion_compensation:
  crop_ratio: 0.9             # Rapporto di crop per evitare bordi (0-1)
  border_mode: "constant"     # Gestione bordi: 'replicate', 'reflect', 'constant'
  interpolation: "linear"     # Interpolazione: 'linear', 'cubic', 'nearest'

# Parametri Video I/O
video:
  input_format: "*.mp4"       # Formato video di input
  output_codec: "H.264"       # Codec output: 'mp4v', 'x264', 'xvid'
  preserve_fps: true          # Mantieni fps originale
  preserve_resolution: true   # Mantieni risoluzione originale

# Opzioni Debug e Visualizzazione
debug:
  show_progress: true         # Mostra progresso durante elaborazione
  save_motion_vectors: false  # Salva motion vectors per analisi
  save_trajectory: false      # Salva traiettoria originale e smussata
  verbose: true               # Output dettagliato

# Salvataggio Metriche per Confronto
save_metrics: true            # Salva metriche dettagliate in JSON (per confronti)
